#!/usr/bin/env bash

echo "ğŸ¨ Start codestyle checking"

# -------------------------------------------------------
# ###                   ğŸ–¤ black                      ###
# -------------------------------------------------------
# Return codes for black (rc)
#   0 - nothing would change
#   1 - some files require formatting
# 123 - internal error

BLACK_VERSION="$(poetry run black --version | sed 's/, version//g')"

echo "ğŸ–¤ $BLACK_VERSION"
poetry run black --diff --check .

BLACK_RC=$?

# -------------------------------------------------------
# ###                   ğŸ”„ isort                      ###
# -------------------------------------------------------
# Return codes for isort (rc)
#   0 - nothing would change
#   1 - some files require formatting

ISORT_VERSION="$(poetry run isort --version | grep 'VERSION' | sed -e 's/\(.*\)VERSION //g')"

echo "ğŸ”„ isort $ISORT_VERSION"
poetry run isort --diff --check .

ISORT_RC=$?

# -------------------------------------------------------
# ###                   ğŸ· mypy                       ###
# -------------------------------------------------------
# Return codes for mypy (rc)
#   0 - there are no typing errors
#   1 - typing errors found, should be fixed ğŸ˜œ

MYPY_VERSION="$(poetry run mypy --version)"

echo "ğŸ· $MYPY_VERSION"
poetry run mypy .

MYPY_RC=$?

# -------------------------------------------------------
if [[ $BLACK_RC -ne 0 || $ISORT_RC -ne 0 || MYPY_RC -ne 0 ]]; then
  echo "ğŸš« Incorrect formatting, you have to clean this up a bit ğŸ§¹ ğŸš®"
  exit 1
else
  echo "ğŸ‘ Good job! Codestyle is awesome ğŸ‘Œ"
fi
